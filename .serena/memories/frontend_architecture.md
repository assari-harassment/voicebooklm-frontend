# フロントエンドアーキテクチャ設計

## このドキュメントの目的

VoiceBookLMフロントエンドのアーキテクチャ設計について、**なぜこの構成を選んだのか**という背景と設計思想を共有します。
初めてこのプロジェクトに参加するメンバーが、コードを読む前に全体像を把握できることを目指しています。

---

## 背景：なぜこのアーキテクチャを選んだのか

### チームの状況

- フロントエンド初心者が多いチーム構成
- 「フォルダを見ただけで何があるか分かる」ことが重要
- 複雑な規約よりも、直感的に理解できる構造を優先

### 既存アーキテクチャの課題

世の中には様々なアーキテクチャがあります：

| アーキテクチャ                   | 特徴                               | 課題                                                       |
| -------------------------------- | ---------------------------------- | ---------------------------------------------------------- |
| **FSD（Feature-Sliced Design）** | 7層構造で大規模アプリ向け          | 学習コストが高い、小規模アプリにはオーバーキル             |
| **Atomic Design**                | atoms/molecules/organisms で分類   | UI部品は整理しやすいが、ビジネスロジックの置き場が曖昧     |
| **技術分類型**                   | components/hooks/services で分ける | 関連ファイルが分散し、機能追加時に複数フォルダを行き来する |

### 採用したアプローチ

**Feature-based Structure（機能ベース構造）** を採用しました。

業界では「Package by Feature」「Feature-First」などとも呼ばれ、
Reactコミュニティでは **Bulletproof React** が有名な参考実装です。

また、Robert C. Martin が提唱する **Screaming Architecture**（叫ぶアーキテクチャ）の考え方を取り入れています：

> フォルダ構造を見ただけで「これは音声メモアプリだ」と分かるべき

---

## 設計の3つの柱

### 1. 機能で分ける（技術で分けない）

**従来の技術分類型**

```
src/
  components/  ← コンポーネント全部
  hooks/       ← フック全部
  services/    ← サービス全部
```

**機能ベース構造**

```
src/features/
  recording/   ← 録音に関する全て
  home/        ← ホーム画面に関する全て
  notes/       ← メモ詳細に関する全て
```

技術的な分類ではなく、「何をする機能か」で分けることで、
新しい機能を追加するときに1つのフォルダで完結します。

### 2. コロケーション（関連コードを近くに置く）

「録音画面の波形コンポーネント」を修正したいとき：

- **技術分類型**: components/ → hooks/ → styles/ と複数フォルダを探す
- **機能ベース**: `features/recording/audio-waveform/` に全てある

関連するものを物理的に近くに置くことで、
コードを追いやすく、修正漏れも防げます。

### 3. 直感的なフォルダ名

一般的なコンポーネント名ではなく、**中身が想像できる名前**を使います：

| 一般的な命名          | 本プロジェクトの命名 |
| --------------------- | -------------------- |
| `components/Waveform` | `audio-waveform/`    |
| `components/Timer`    | `recording-timer/`   |
| `components/FAB`      | `record-fab/`        |
| `components/Header`   | `user-header/`       |

フォルダ名を見ただけで「ああ、録音のタイマー表示だな」と分かることを目指しています。

---

## レイヤーの役割分担

本プロジェクトでは、コードを3つのレイヤーに分けています。

### app/ - ルーティング層

**役割**: URLとファイルの対応付けのみ

- Expo Routerのファイルベースルーティングを活用
- ビジネスロジックは一切書かない
- features/ のScreenコンポーネントをimportして返すだけ
- **理想は3行以内**

### features/ - 機能層

**役割**: 実際のアプリケーションロジック

- 1つの機能 = 1つのフォルダ
- 機能ごとに `XxxScreen.tsx` が統合役（ロジック担当）
- 子コンポーネントはUI表示に専念（props を受け取って描画）
- 機能内で完結するものは外に公開しない

### shared/ - 共通層

**役割**: 複数機能で使うもの

- colors, typographyなどのデザイントークン
- User, Noteなどの共通型定義
- **ルール**: 最初からここに入れない。2箇所以上で使うようになったら移動を検討

---

## Screen コンポーネントの設計思想

各機能の `XxxScreen.tsx` は**統合役**として設計されています。

### Screenの責務

- 状態管理（useState, useEffect など）
- イベントハンドラの定義
- 子コンポーネントの組み合わせ

### 子コンポーネントの責務

- props を受け取る
- UIを描画する
- イベントは親にコールバックで伝える

この分離により：

- Screenを読めば機能全体の流れが分かる
- 子コンポーネントは独立してテスト・再利用可能
- ロジックとUIが明確に分離される

---

## 判断の指針

### ファイルを分割するタイミング

- 400行を超えたら分割を検討
- 迷ったらまず1ファイルに。大きくなったら分割

### shared/ に移動するタイミング

- 2つ以上の feature で同じコードが必要になったとき
- 最初から「使い回しそう」で shared に入れない

### フォルダを作るタイミング

- コンポーネント + 関連ファイル（型、ユーティリティ等）がセットになるとき
- 単一のコンポーネントなら `XxxComponent.tsx` で十分

---

## やってはいけないこと

| NG パターン                            | 理由                             |
| -------------------------------------- | -------------------------------- |
| shared/ に最初から入れる               | 使われるか分からないものが溜まる |
| app/ にロジックを書く                  | ルーティング層が肥大化する       |
| components/ に全コンポーネントを入れる | 機能ごとの関連が見えなくなる     |
| 技術分類で深い階層を作る               | 関連ファイルが分散する           |

---

## 参考資料

- **Bulletproof React**: https://github.com/alan2207/bulletproof-react
  - React の Feature-based 構造の代表的な実装例
- **Screaming Architecture** (Robert C. Martin)
  - フォルダ構造でアプリの目的を表現する考え方

---

## まとめ

このアーキテクチャは「初心者でも迷わない」ことを最優先に設計しています。

- フォルダ名を見れば中身が分かる
- 関連ファイルは同じ場所にある
- ルールは少なく、直感的

複雑さを追求するのではなく、**チームで運用できるシンプルさ**を選びました。
